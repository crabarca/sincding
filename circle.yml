machine:
  node:
    version: 7.10.0
  environment:
    CODECLIMATE_REPO_TOKEN: b7027884e6eb3d094fa9a345ff98a4a42c8f97425906051a53ea7e8cb63197f6

dependencies:
  pre:
    # - npm install -g pkg
    - npm i -g yarn
    - npm install -g codeclimate-test-reporter
    - yarn global add greenkeeper-lockfile
  cache_directories:
    - node_modules
    - yarn.lock

test:
  pre:
    - greenkeeper-lockfile-update
    - yarn
    - yarn lint
    - ./scripts/configTest.sh
  override:
    - yarn test:coverage
  post:
    - greenkeeper-lockfile-upload
    - cp -r ./coverage $CIRCLE_ARTIFACTS/coverage
    - codeclimate-test-reporter < ./coverage/lcov.info
    # - pkg package.json --out-dir $CIRCLE_ARTIFACTS
    # - for executable in $(ls $CIRCLE_ARTIFACTS); do chmod +x "$CIRCLE_ARTIFACTS/$executable"; done

# deployment:
#   release:
#     tag: /v[0-9]+(\.[0-9]+)*/
#     owner: open-source-uc
#     commands:
#       - brew tap tcnksm/ghr
#       - brew install ghr
#       - ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME $CIRCLE_TAG $CIRCLE_ARTIFACTS/ || true
